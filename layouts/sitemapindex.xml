{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML -}}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- /* Собираем все страницы из всех языков для единого sitemap */ -}}
  {{- $allPages := slice -}}
  {{- $seen := dict -}}
  {{- range . -}}
    {{- $langPages := where (where (where (where .AllPages "Kind" "ne" "taxonomy") "Kind" "ne" "term") "Sitemap.Disable" "ne" true) "IsPage" true -}}
    {{- range $langPages -}}
      {{- if not (isset $seen .Permalink) -}}
        {{- $seen = merge $seen (dict .Permalink true) -}}
        {{- $allPages = $allPages | append . -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
  {{- $pages := $allPages -}}

  {{- range $pages -}}
  {{- $lastmod := .Lastmod -}}
  {{- if .Params.lastmod -}}
    {{- $lastmod = time .Params.lastmod -}}
  {{- end -}}
  <url>
    <loc>{{ .Permalink }}</loc>{{ if not $lastmod.IsZero }}<lastmod>{{ $lastmod.Format "2006-01-02T15:04:05Z07:00" }}</lastmod>{{ end }}{{ with .Sitemap.ChangeFreq }}<changefreq>{{ . }}</changefreq>{{ end }}{{ if ge .Sitemap.Priority 0.0 }}<priority>{{ .Sitemap.Priority }}</priority>{{ end }}
    {{- if .IsTranslated -}}
      {{- range .Translations -}}
    <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}"/>
      {{- end -}}
    <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}"/>
    {{- end -}}
  </url>
  {{- end -}}
</urlset>
